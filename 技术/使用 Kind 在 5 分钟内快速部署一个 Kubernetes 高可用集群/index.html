<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://weizhiwang221.github.io/cloud-native-journey/%E6%8A%80%E6%9C%AF/%E4%BD%BF%E7%94%A8%20Kind%20%E5%9C%A8%205%20%E5%88%86%E9%92%9F%E5%86%85%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA%20Kubernetes%20%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>使用 Kind 在 5 分钟内快速部署一个 Kubernetes 高可用集群 - MengQiu Twenty-nine</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u5b89\u88c5 Kind", url: "#_top", children: [
              {title: "\u5b89\u88c5 Kind \u4f9d\u8d56\u7ec4\u4ef6", url: "#kind_1" },
              {title: "\u5b89\u88c5 Kind", url: "#kind_2" },
          ]},
          {title: "\u4f7f\u7528 Kind", url: "#kind_3", children: [
          ]},
          {title: "\u4f7f\u7528 Kind \u521b\u5efa Kubernetes \u96c6\u7fa4", url: "#kind-kubernetes", children: [
              {title: "\u642d\u5efa\u4e00\u4e2a\u5355\u8282\u70b9\u96c6\u7fa4", url: "#_1" },
              {title: "\u521b\u5efa\u591a\u8282\u70b9\u7684\u96c6\u7fa4", url: "#_2" },
              {title: "\u521b\u5efa\u9ad8\u53ef\u7528 Kubernetes \u96c6\u7fa4", url: "#kubernetes" },
          ]},
          {title: "\u5176\u5b83\u76f8\u5173\u77e5\u8bc6", url: "#_3", children: [
              {title: "Kind \u7684\u955c\u50cf\u91cc\u7684\u79d8\u5bc6", url: "#kind_4" },
              {title: "\u5982\u4f55\u5feb\u901f\u5220\u9664\u4e00\u4e2a\u96c6\u7fa4", url: "#_4" },
          ]},
          {title: "\u53c2\u8003\u6587\u6863", url: "#_5", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../%E6%95%85%E9%9A%9C/docker%E6%95%85%E9%9A%9C/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../%E6%95%85%E9%9A%9C/docker%E6%95%85%E9%9A%9C/" class="btn btn-xs btn-link">
        docker故障
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../kubernetes%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7%E5%88%86%E6%9E%90/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../kubernetes%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7%E5%88%86%E6%9E%90/" class="btn btn-xs btn-link">
        Kubernetes各个组件的版本兼容性分析
      </a>
    </div>
    
  </div>

    

    <p><strong>什么是 Kind</strong></p>
<p><code>Kind</code>（Kubernetes in Docker） 是一个 <code>Kubernetes</code> 孵化项目，<code>Kind</code> 是一套开箱即用的 <code>Kubernetes</code> 环境搭建方案。顾名思义，就是将 <code>Kubernetes</code> 所需要的所有组件，全部部署在一个 <code>Docker</code> <a href="https://cloud.tencent.com/product/tke?from_column=20065&amp;from=20065">容器</a>中，可以很方便的搭建 <code>Kubernetes</code> 集群。</p>
<p><code>Kind</code> 已经广泛的应用于 <code>Kubernetes</code> 上游及相关项目的 <code>CI</code> 环境中，官方文档中也把 <code>Kind</code> 作为一种本地集群搭建的工具推荐给大家。</p>
<blockquote>
<p>项目地址：https://github.com/kubernetes-sigs/kind</p>
</blockquote>
<p><strong>Kind 可以做什么？</strong></p>
<ol>
<li>快速创建一个或多个 <code>Kubernetes</code> 集群</li>
<li>支持部署高可用的 <code>Kubernetes</code> 集群</li>
<li>支持从源码构建并部署一个 <code>Kubernetes</code> 集群</li>
<li>可以快速低成本体验一个最新的 <code>Kubernetes</code> 集群，并支持 <code>Kubernetes</code> 的绝大部分功能</li>
<li>支持本地离线运行一个多节点集群</li>
</ol>
<p><strong>Kind 有哪些优势？</strong></p>
<ol>
<li>最小的安装依赖，仅需要安装 <code>Docker</code> 即可</li>
<li>使用方法简单，只需 <code>Kind Cli</code> 工具即可快速创建集群</li>
<li>使用容器来模似 <code>Kubernetes</code> 节点</li>
<li>内部使用 <code>Kubeadm</code> 的官方主流部署工具</li>
<li>通过了 <code>CNCF</code> 官方的 <code>K8S Conformance</code> 测试</li>
</ol>
<p><strong>Kind 是如何工作的？</strong></p>
<p><img alt="img" src="C:\Users\Administrator\Desktop\cloudops文章\ok2xymr355.gif" /></p>
<p><code>Kind</code> 使用容器来模拟每一个 <code>Kubernetes</code> 节点，并在容器里面运行 <code>Systemd</code>。 容器里的 <code>Systemd</code> 托管了 <code>Kubelet</code> 和 <code>Containerd</code>，然后容器内部的 <code>Kubelet</code> 把其它 <code>Kubernetes</code> 组件：<code>Kube-Apiserver</code>、<code>Etcd</code>、<code>CNI</code> 等等组件运行起来。</p>
<p><code>Kind</code> 内部使用了 <code>Kubeadm</code> 这个工具来做集群的部署，包括高可用集群也是借助 <code>Kubeadm</code> 提供的特性来完成的。在高用集群下还会额外部署了一个 <code>Nginx</code> 来提供<a href="https://cloud.tencent.com/product/clb?from_column=20065&amp;from=20065">负载均衡</a> <code>VIP</code>。</p>
<h2 id="kind"><strong>安装 Kind</strong></h2>
<h3 id="kind_1"><strong>安装 Kind 依赖组件</strong></h3>
<p><code>Kind</code> 把部署 <code>Kubernetes</code> 环境的依赖降低到了最小，仅需要机器安装 <code>Docker</code> 即可。</p>
<ol>
<li>安装 Docker</li>
</ol>
<p>这里以 <code>Linux</code> 系统为例：</p>
<pre><code class="language-javascript">$ curl -sSL https://get.daocloud.io/docker | sh
</code></pre>
<p>更多平台的安装方法可参考官方文档：https://docs.docker.com/install/</p>
<ol>
<li>安装 Kubectl</li>
</ol>
<p>如果你需要通过命令行管理集群，则需要安装 <code>Kubectl</code>。</p>
<p>这里以 <code>Linux</code> 系统为例：</p>
<pre><code class="language-javascript">$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.15.0/bin/linux/amd64/kubectl
$ chmod +x ./kubectl
$ sudo mv ./kubectl /usr/local/bin/kubectl
</code></pre>
<p>更多平台的安装方法可参考官方文档：https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl</p>
<h3 id="kind_2"><strong>安装 Kind</strong></h3>
<p><code>Kind</code> 使用 <code>Golang</code> 进行开发，原生支持良好的跨平台特性，通常只需要直接下载构建好的二进制文件就可使用。</p>
<ol>
<li>
<p>通过二进制安装</p>
</li>
<li>
<p>Linux</p>
</li>
</ol>
<pre><code class="language-javascript">$ curl -Lo ./kind https://github.com/kubernetes-sigs/kind/releases/download/v0.5.1/kind-linux-amd64
$ chmod +x ./kind
$ mv ./kind /usr/local/bin/kind
</code></pre>
<ul>
<li>Windows</li>
</ul>
<pre><code class="language-javascript">$ curl.exe -Lo kind-windows-amd64.exe https://github.com/kubernetes-sigs/kind/releases/download/v0.5.1/kind-windows-amd64
$ mv .\kind-windows-amd64.exe c:\kind.exe
</code></pre>
<p>更多平台的安装方法可参考官方文档：https://kind.sigs.k8s.io/docs/user/quick-start/</p>
<ol>
<li>通过源码安装</li>
</ol>
<p>如果本地环境已经配置好 Golang (1.11+)  的开发环境，你也可以直接通过源码进行安装。</p>
<pre><code class="language-javascript">$ go get sigs.k8s.io/kind@v0.5.1
</code></pre>
<p>运行完上述命令后，会将 <code>Kind</code> 的可执行文件放到 <code>$GOPATH/bin</code> 目录内。为了方便使用，你需要将此目录加入到 <code>$PATH</code> 中。</p>
<h2 id="kind_3"><strong>使用 Kind</strong></h2>
<p>安装完成之后，我们可以来看看 <code>Kind</code> 支持哪些命令行操作。</p>
<pre><code class="language-javascript">$ kind
kind creates and manages local Kubernetes clusters using Docker container 'nodes'

Usage:
  kind [command]

Available Commands:
  build       Build one of [base-image, node-image]
  create      Creates one of [cluster]
  delete      Deletes one of [cluster]
  export      exports one of [logs]
  get         Gets one of [clusters, nodes, kubeconfig-path]
  help        Help about any command
  load        Loads images into nodes
  version     prints the kind CLI version

Flags:
  -h, --help              help for kind
      --loglevel string   logrus log level [panic, fatal, error, warning, info, debug] (default &quot;warning&quot;)
      --version           version for kind

Use &quot;kind [command] --help&quot; for more information about a command.
</code></pre>
<p>简单说下几个比较常用选项的含义：</p>
<ul>
<li><code>build</code>：用来从 <code>Kubernetes</code> 源代码构建一个新的镜像。</li>
<li><code>create</code>：创建一个 <code>Kubernetes</code> 集群。</li>
<li><code>delete</code>：删除一个 <code>Kubernetes</code> 集群。</li>
<li><code>get</code>：可用来查看当前集群、节点信息以及 <code>Kubectl</code> 配置文件的地址。</li>
<li><code>load</code>：从<a href="https://cloud.tencent.com/product/cdh?from_column=20065&amp;from=20065">宿主机</a>向 <code>Kubernetes</code> 节点内导入镜像。</li>
</ul>
<h2 id="kind-kubernetes"><strong>使用 Kind 创建 Kubernetes 集群</strong></h2>
<h3 id="_1"><strong>搭建一个单节点集群</strong></h3>
<p>搭建单节点集群是 <code>Kind</code> 最基础的功能，当然使用起来也很简单，仅需一条指令即可完成。</p>
<pre><code class="language-javascript">$ kind create cluster --name my-cluster
Creating cluster &quot;my-cluster&quot; ...
 ✓ Ensuring node image (kindest/node:v1.15.3) ?
 ✓ Preparing nodes ?
 ✓ Creating kubeadm config ?
 ✓ Starting control-plane ?️
Cluster creation complete. You can now use the cluster with:

export KUBECONFIG=&quot;$(kind get kubeconfig-path --name=&quot;my-cluster&quot;)&quot;
kubectl cluster-info
</code></pre>
<blockquote>
<p>以上命令中 <code>--name</code> 是可选参数。如果不指定，默认创建出来的集群名字为 <code>kind</code>。</p>
</blockquote>
<p>使用默认安装的方式时，我们没有指定任何配置文件。从安装过程的输出来看，一共分为 4 步：</p>
<ul>
<li>检查本地环境是否存在一个基础的安装镜像，默认是 <code>kindest/node:v1.15.3</code>，该镜像里面包含了所有需要安装的东西，包括：<code>kubectl</code>、<code>kubeadm</code>、<code>kubelet</code> 的二进制文件，以及安装对应版本 <code>Kubernetes</code> 所需要的镜像。</li>
<li>准备 <code>Kubernetes</code> 节点，主要就是启动容器、解压镜像这类的操作。</li>
<li>建立对应的 <code>kubeadm</code> 的配置，完成之后就通过 <code>kubeadm</code> 进行安装。安装完成后还会做一些清理操作，比如：删掉主节点上的污点，否则对于没有容忍的 <code>Pod</code> 无法完成部署。</li>
<li>上面所有操作都完成后，就成功启动了一个 <code>Kubernetes</code> 集群并输出一些操作集群的提示信息。</li>
</ul>
<blockquote></blockquote>
<ol>
<li>默认情况下，<code>Kind</code> 会先下载 <code>kindest/node:v1.15.3</code> 镜像。如果你想指定不同版本，可以使用 <code>--image</code> 参数，类似这样：<code>kind create cluster --image kindest/node:v1.15.3</code> </li>
<li><code>kindest/node</code> 这个镜像目前托管于 Docker Hub 上，下载时可能会较慢。同样的问题 <code>Kind</code> 进行集群的创建也是存在的，<code>Kind</code> 实际使用 <code>Kubeadm</code> 进行集群的创建。对 <code>Kubeadm</code> 有所了解的同学都知道它默认使用的镜像在国内是不能访问的，所以一样需要自行解决网络问题。</li>
<li>如果你存在上面说的网络问题，最好配置一个国内的加速器或者镜像源。如果你还不知道如何配置加速器和镜像源可以参考：「<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTI2NzkxMA%3D%3D%26mid%3D2247488553%26idx%3D1%26sn%3D14cbe47bc50df50f536345efb4d10b5e%26chksm%3Deac53500ddb2bc16be6bbfe69917895d0feed7c4e85d40450a5adb931ff01257d9f546c58538%26token%3D687022088%26lang%3Dzh_CN%26scene%3D21%23wechat_redirect"><strong>Docker / Kubernetes 镜像源不可用，教你几招搞定它！</strong></a>」和 「<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTI2NzkxMA%3D%3D%26mid%3D2247483698%26idx%3D1%26sn%3Ddfb6edca74539a9a4d8228495d1c17a0%26chksm%3Deac5201bddb2a90d5f8e6d4733ed2d0ff9466474471933e4ea5d5fc1ef6be15b86470f50eccb%26token%3D21948731%26lang%3Dzh_CN%26scene%3D21%23wechat_redirect"> <strong>Docker 下使用 DaoCloud / 阿里云镜像加速</strong></a>」两篇文章。</li>
</ol>
<p>接下来，我们根据上面命令执行完后，输出的提示信息进行操作来验证一下集群是否部署成功。</p>
<pre><code class="language-javascript"># 获取指定集群的配置文件所在的路径
$ export KUBECONFIG=&quot;$(kind get kubeconfig-path --name=&quot;my-cluster&quot;)&quot;
$ kubectl cluster-info
Kubernetes master is running at https://localhost:34458
KubeDNS is running at https://localhost:34458/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

$ kubectl get nodes
NAME                       STATUS    ROLES     AGE       VERSION
my-cluster-control-plane   Ready     master    2m        v1.15.3

$ kubectl get po -n kube-system
NAME                                                  READY   STATUS    RESTARTS   AGE
coredns-86c58d9df4-6g66f                              1/1     Running   0          21m
coredns-86c58d9df4-pqcc4                              1/1     Running   0          21m
etcd-my-cluster-control-plane                         1/1     Running   0          20m
kube-apiserver-my-cluster-control-plane               1/1     Running   0          20m
kube-controller-manager-my-cluster-control-plane      1/1     Running   0          20m
kube-proxy-cjgnt                                      1/1     Running   0          21m
kube-scheduler-my-cluster-control-plane               1/1     Running   0          21m
weave-net-ls2v8                                       2/2     Running   1          21m
</code></pre>
<p>从上面的输出结果，可以看到单节点的 <code>Kubernetes</code> 已经搭建成功。单节点集群默认方式启动的节点类型是 <code>control-plane</code>，该节点包含了所有的组件。这些组件分别是：<code>2*Coredns</code>、<code>Etcd</code>、<code>Api-Server</code>、<code>Controller-Manager</code>、<code>Kube-Proxy</code>、<code>Sheduler</code> 和网络插件 <code>Weave</code>，目前默认使用的网络插件也是 <code>Weave</code>。</p>
<h3 id="_2"><strong>创建多节点的集群</strong></h3>
<p>默认安装的集群只部署了一个控制节点，如果需要部署多节点集群，我们可以通过配置文件的方式来创建多个容器。这样就可以达到模拟多个节点目的，并以这些节点来构建一个多节点的 <code>Kubernetes</code> 集群。</p>
<ol>
<li>创建多节点 Kubernetes 集群配置文件</li>
</ol>
<p><code>Kind</code> 在创建集群的时候，支持通过 <code>--config</code> 参数传递配置文件给 <code>Kind</code>，配置文件可修改的内容主要有 role 和 节点使用的镜像。</p>
<pre><code class="language-javascript">$ vim my-cluster-multi-node.yaml
# 一共两个节点，一个主节点，一个从节点。
kind: Cluster
apiVersion: kind.sigs.k8s.io/v1alpha3
nodes:
- role: control-plane
- role: worker
</code></pre>
<ol>
<li>创建多节点 Kubernetes 集群</li>
</ol>
<p>配置文件创建完成后，就可以使用下面的命令来完成多节点 <code>Kubernetes</code> 集群搭建。</p>
<pre><code class="language-javascript">$ kind create cluster --config my-cluster-multi-node.yaml --name my-cluster-multi-node
Creating cluster &quot;my-cluster-multi-node&quot; ...
 ✓ Ensuring node image (kindest/node:v1.15.3) ?
 ✓ Preparing nodes ?? 
 ✓ Creating kubeadm config ? 
 ✓ Starting control-plane ?️ 
 ✓ Joining worker nodes ? 
Cluster creation complete. You can now use the cluster with:

export KUBECONFIG=&quot;$(kind get kubeconfig-path --name=&quot;my-cluster-multi-node&quot;)&quot;
kubectl cluster-info
</code></pre>
<p>和上面创建的单节点集群一样，我们同样根据上面命令执行完后，输出的提示信息进行操作来验证一下集群是否部署成功。</p>
<pre><code class="language-javascript">$ kubectl get nodes
NAME                                  STATUS   ROLES    AGE     VERSION
my-cluster-multi-node-control-plane   Ready    master   3m20s   v1.15.3
my-cluster-multi-node-worker          Ready    &lt;none&gt;   3m8s    v1.15.3

$ kubectl get po -n kube-system
NAME                                                          READY   STATUS    RESTARTS   AGE
coredns-86c58d9df4-cnqhc                                      1/1     Running   0          5m29s
coredns-86c58d9df4-hn9mv                                      1/1     Running   0          5m29s
etcd-my-cluster-multi-node-control-plane                      1/1     Running   0          4m24s
kube-apiserver-my-cluster-multi-node-control-plane            1/1     Running   0          4m17s
kube-controller-manager-my-cluster-multi-node-control-plane   1/1     Running   0          4m21s
kube-proxy-8t4xt                                              1/1     Running   0          5m27s
kube-proxy-skd5v                                              1/1     Running   0          5m29s
kube-scheduler-my-cluster-multi-node-control-plane            1/1     Running   0          4m18s
weave-net-nmfq2                                               2/2     Running   1          5m27s
weave-net-srdfw                                               2/2     Running   0          5m29s
</code></pre>
<h3 id="kubernetes"><strong>创建高可用 Kubernetes 集群</strong></h3>
<p><code>Kind</code> 也支持搭建高可用的 <code>Kubernetes</code> 集群，创建方式和多节点集群类似，也是通过配置文件来实现。</p>
<ol>
<li>创建高可用 Kubernetes 集群配置文件</li>
</ol>
<pre><code class="language-javascript">$ vim my-cluster-ha.yaml

# 一共六个节点，三个 control-plane 节点，三个 workers 节点
kind: Cluster
apiVersion: kind.sigs.k8s.io/v1alpha3
kubeadmConfigPatches:
- |
  apiVersion: kubeadm.k8s.io/v1beta2
  kind: ClusterConfiguration
  metadata:
    name: config
  networking:
    serviceSubnet: 10.0.0.0/16
  imageRepository: registry.aliyuncs.com/google_containers
  nodeRegistration:
    kubeletExtraArgs:
      pod-infra-container-image: registry.aliyuncs.com/google_containers/pause:3.1
- |
  apiVersion: kubeadm.k8s.io/v1beta2
  kind: InitConfiguration
  metadata:
    name: config
  networking:
    serviceSubnet: 10.0.0.0/16
  imageRepository: registry.aliyuncs.com/google_containers
nodes:
- role: control-plane
- role: control-plane
- role: control-plane
- role: worker
- role: worker
- role: worker
</code></pre>
<blockquote>
<p>这里，我们通过直接在配置文件里使用国内容器镜像源的方式解决了官方容器镜像源不可用的问题，同时也达到了加速集群创建的目的。</p>
</blockquote>
<ol>
<li>创建高可用 Kubernetes 集群</li>
</ol>
<p>配置文件创建完成后，就可以使用下面的命令来完成高可用 <code>Kubernetes</code> 集群搭建。</p>
<pre><code class="language-javascript">$ kind create cluster --name my-cluster-ha --config my-cluster-ha.yaml
Creating cluster &quot;my-cluster-ha&quot; ...
 ✓ Ensuring node image (kindest/node:v1.15.3) ?
 ✓ Preparing nodes ???????
 ✓ Starting the external load balancer ⚖️
 ✓ Creating kubeadm config ?
 ✓ Starting control-plane ?️
 ✓ Joining more control-plane nodes ?
 ✓ Joining worker nodes ?
Cluster creation complete. You can now use the cluster with:

export KUBECONFIG=&quot;$(kind get kubeconfig-path --name=&quot;my-cluster-ha&quot;)&quot;
kubectl cluster-info
master $ export KUBECONFIG=&quot;$(kind get kubeconfig-path --name=&quot;my-cluster-ha&quot;)&quot;
master $ kubectl cluster-info
Kubernetes master is running at https://localhost:44019
KubeDNS is running at https://localhost:44019/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
</code></pre>
<p>同样，我们根据上面命令执行完后，输出的提示信息进行操作来验证一下集群是否部署成功。</p>
<pre><code class="language-javascript">$ kubectl get nodes
NAME                           STATUS   ROLES    AGE     VERSION
my-cluster-ha-control-plane    Ready    master   3m42s   v1.15.3
my-cluster-ha-control-plane2   Ready    master   3m24s   v1.15.3
my-cluster-ha-control-plane3   Ready    master   2m13s   v1.15.3
my-cluster-ha-worker           Ready    &lt;none&gt;   96s     v1.15.3
my-cluster-ha-worker2          Ready    &lt;none&gt;   98s     v1.15.3
my-cluster-ha-worker3          Ready    &lt;none&gt;   95s     v1.15.3
</code></pre>
<p>从上面的输出结果，可以看到包含了多个 master 节点，说明高可用的 <code>Kubernetes</code> 集群已经搭建成功。</p>
<h2 id="_3"><strong>其它相关知识</strong></h2>
<h3 id="kind_4"><strong>Kind 的镜像里的秘密</strong></h3>
<p><code>Kind</code> 镜像一共分为两类，一类是 <code>Base</code> 镜像，另一类是 <code>Node</code> 镜像。</p>
<ol>
<li>Base 镜像</li>
</ol>
<p>Base 镜像目前使用了 <code>ubuntu:19.04</code> 作为基础镜像，并做了下面的调整：</p>
<ul>
<li>安装 <code>Systemd</code> 相关的包，并调整一些配置以适应在容器内运行。</li>
<li>安装 <code>Kubernetes</code> 运行时的依赖包，比如: <code>Conntrack</code>、<code>Socat</code>、<code>CNI</code> 等。</li>
<li>安装容器运行环境，比如: <code>Containerd</code>、<code>Crictl</code> 等。</li>
<li>配置自己的 <code>ENTRYPOINT</code> 脚本，以适应和调整容器内运行的问题。</li>
</ul>
<p>更多具体的构建逻辑可以参考：https://github.com/kubernetes-sigs/kind/blob/master/images/base/Dockerfile</p>
<ol>
<li>Node 镜像</li>
</ol>
<p><code>Node</code> 镜像的构建比较复杂，目前是通过运行 <code>Base</code> 镜像并在 <code>Base</code> 镜像内执行操作，再保存此容器内容为镜像的方式来构建的，包含的操作有：</p>
<ul>
<li>构建 <code>Kubernetes</code> 相关资源，比如：二进制文件和镜像。</li>
<li>运行一个用于构建的容器</li>
<li>把构建的 <code>Kubernetes</code> 相关资源复制到容器里</li>
<li>调整部分组件配置参数，以支持在容器内运行</li>
<li>预先拉去运行环境需要的镜像</li>
<li>通过 <code>docker commit</code> 方式保存当前的构建容器为 <code>Node</code> 镜像</li>
</ul>
<h3 id="_4"><strong>如何快速删除一个集群</strong></h3>
<p>如果你不需要本地的集群环境，通过以下命令进行删除：</p>
<pre><code class="language-javascript">$ kind delete  cluster --name my-cluster
Deleting cluster &quot;my-cluster&quot; ...
$KUBECONFIG is still set to use /root/.kube/kind-config-my-cluster even though that file has been deleted, remember to unset it
</code></pre>
<p>至此，我们就演示完了如何使用 <code>Kind</code> 快速搭建一个 <code>Kubernetes</code> 集群。不过有一个你需要注意的地方，<code>Kind</code> 搭建的集群不适用于生产环境中使用。但是如果你想在本地快速构建一个 <code>Kubernetes</code> 集群环境，并且不想占用太多的硬件资源，那么 <code>Kind</code> 会是你不错的选择。</p>
<h2 id="_5"><strong>参考文档</strong></h2>
<ol>
<li>https://www.google.com</li>
<li>http://t.cn/AiRVBwDS</li>
<li>https://zhuanlan.zhihu.com/p/60464867</li>
<li>https://yeya24.github.io/post/kind/</li>
<li>http://dockerone.com/article/8974</li>
<li>https://kind.sigs.k8s.io/docs/user/quick-start/</li>
</ol>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../%E6%95%85%E9%9A%9C/docker%E6%95%85%E9%9A%9C/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../%E6%95%85%E9%9A%9C/docker%E6%95%85%E9%9A%9C/" class="btn btn-xs btn-link">
        docker故障
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../kubernetes%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7%E5%88%86%E6%9E%90/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../kubernetes%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7%E5%88%86%E6%9E%90/" class="btn btn-xs btn-link">
        Kubernetes各个组件的版本兼容性分析
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content"><p>Copyright &copy; 2025 Weizhi Wang | 
<a href="https://github.com/weizhiwang221/cloud-native-journey" target="_blank" rel="noopener">View on GitHub</a>
</p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>