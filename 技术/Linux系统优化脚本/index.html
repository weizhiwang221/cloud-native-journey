<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://weizhiwang221.github.io/cloud-native-journey/%E6%8A%80%E6%9C%AF/Linux%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96%E8%84%9A%E6%9C%AC/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Linux系统优化脚本 - MengQiu Twenty-nine</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../kubectl%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../kubectl%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="btn btn-xs btn-link">
        kubectl 常用命令
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../K8s%201.32.6%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../K8s%201.32.6%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" class="btn btn-xs btn-link">
        K8s 1.32.6版本部署文档
      </a>
    </div>
    
  </div>

    

    <pre><code class="language-shell">#!/bin/bash
export LANG=en_US.UTF-8
#返回脚本文件存放路径
script_path=$(cd `dirname $0`; pwd)
sys_date=`date +&quot;%Y%m%d%H%M&quot;`
monitor=/etc/profile.d/monitor.sh
monitorlog_path=/var/log/.hist 
user_name=admin
user_passwd='zxcvbnm!@#123'
#判断系统发行版本大版本号，centos 6、centos 7
release_el6=`uname -a|awk '{print $3}'|grep -v grep|grep el6|wc -l`
release_el7=`uname -a|awk '{print $3}'|grep -v grep|grep el7|wc -l`

#判断系统发行版本大版本号，centos 6、centos 7


#系统最大文件打开数
function sys_limits()
{
#修改系统最大文件打开数
limits=`cat /etc/security/limits.conf|grep -v grep|grep -v &quot;^#&quot;|grep -E &quot;65536|65536&quot;|wc -l`
if [ $limits -le 1 ] ;
then
echo -e &quot;\n&quot; &gt;&gt; /etc/security/limits.conf
echo -e &quot;*       soft     nofile  65536&quot; &gt;&gt; /etc/security/limits.conf
echo -e &quot;*       soft     nproc  65536\n&quot; &gt;&gt; /etc/security/limits.conf
echo -e &quot;*       hard     nofile  65536\n&quot; &gt;&gt; /etc/security/limits.conf
echo -e &quot;*       hard     nproc  65536\n&quot; &gt;&gt; /etc/security/limits.conf
wait
sed -i &quot;/ulimit/d&quot; /etc/profile
echo -e &quot;ulimit -n 65536&quot; &gt;&gt; /etc/profile
wait
#Java程序优化---20190904新增
#解决Java程序在Linux上运行虚拟内存耗用大的问题
sed -i '/'MALLOC_ARENA_MAX'/d' /etc/profile
echo -e &quot;export MALLOC_ARENA_MAX=1&quot; &gt;&gt; /etc/profile
wait
source  /etc/profile
echo &quot;系统最大文件打开数修改完成！&quot;
fi
}



function sys_timezone()
{
###检查时区配置
local time_zone=`date -R | awk '{print $6}'`
if [ &quot;$time_zone&quot; = &quot;+0800&quot; ] ;
then
echo &quot;&quot;
 echo -e &quot;系统时区设置正确！\n&quot;
 echo &quot;&quot;
else
 echo &quot;&quot;
 echo -e &quot;\n系统时区设置错误！\n&quot;
 echo -e &quot;开始更改时区设置.........\n&quot;
 sleep 2
 yes|cp -f /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime
 sleep 2
 ###嵌套if函数 1***
   unset time_zone
   local time_zone=`date -R | awk '{print $6}'`
   if [ &quot;$time_zone&quot; = &quot;+0800&quot; ] ;
   then
   echo -e &quot;\033[32m系统时区更改成功！\n\033[0m&quot;
   #绿色字
   else
   echo -e &quot;\033[31m系统时区更改失败！\n\033[0m&quot;
   #红色字
   exit
   fi
 ###嵌套if函数 1***
fi

}


#内核优化
function kernel_optimize()
{
echo &quot;执行内核优化..........&quot;
#不管参数在不在，先删除，避免重复添加
sed -i '/'fs.file-max'/d' /etc/sysctl.conf 
sed -i '/'net.ipv4.tcp_max_tw_buckets'/d' /etc/sysctl.conf        
sed -i '/'net.ipv4.tcp_max_syn_backlog'/d' /etc/sysctl.conf     
sed -i '/'net.ipv4.tcp_timestamps'/d' /etc/sysctl.conf     
sed -i '/'net.ipv4.ip_local_port_range'/d' /etc/sysctl.conf    
sed -i '/'net.ipv4.tcp_tw_recycle'/d' /etc/sysctl.conf        
sed -i '/'net.ipv4.tcp_tw_reuse'/d' /etc/sysctl.conf 
sed -i '/'net.ipv4.tcp_fin_timeout'/d' /etc/sysctl.conf     
sed -i '/'vm.swappiness'/d' /etc/sysctl.conf
sed -i '/'net.core.netdev_max_backlog'/d' /etc/sysctl.conf     
sed -i '/'net.ipv4.tcp_syn_retries'/d' /etc/sysctl.conf     

wait

#添加内核优化参数
echo -e '
fs.file-max = 999999
net.core.netdev_max_backlog = 8096
net.ipv4.tcp_syn_retries = 1
net.ipv4.tcp_max_tw_buckets = 6000
net.ipv4.tcp_max_syn_backlog = 10000
net.ipv4.tcp_timestamps = 0
net.ipv4.ip_local_port_range = 1024    65500
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30
vm.swappiness = 0 ' &gt;&gt;  /etc/sysctl.conf

echo &quot;------------------------&quot;
sed -i '/'bridge'/d' /etc/rc.local
echo &quot;modprobe bridge&quot; &gt;&gt; /etc/rc.local
modprobe bridge

sysctl -p
echo &quot;------------------------&quot;

}

###调用函数

sys_limits

sys_timezone
kernel_optimize



</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../kubectl%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../kubectl%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="btn btn-xs btn-link">
        kubectl 常用命令
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../K8s%201.32.6%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../K8s%201.32.6%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" class="btn btn-xs btn-link">
        K8s 1.32.6版本部署文档
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content"><p>Copyright &copy; 2025 WeiZhiwang | 
<a href="https://github.com/weizhiwang221/cloud-native-journey" target="_blank" rel="noopener">View on GitHub</a>
</p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>